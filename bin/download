#!/usr/bin/env bash

source "$(dirname "$0")/../lib/utils.sh"

http_download() {
  local version=$1
  local path=$2
  local install_type=$3

  local url="$(download_url $version)"

  if [ "$install_type" != "version" ]; then
    echo "Install type '$install_type' not supported."
    exit 1
  fi

  if [ -z "$url" ]; then
    echo "URL not found for version '$version'."
    exit 1
  fi

  local tmp_file="${path}/rakudo.tar.gz.$(date +%s)"
  local ret=1
  echo "Downloading $url to ${path}/rakudo.tar.gz ..."
  if curl --version &>/dev/null; then
    curl -fsSL -o $tmp_file $url
    ret=$?
  elif wget --version &>/dev/null; then
    wget -q -O $tmp_file $url
    ret=$?
  else
    echo "'curl' or 'wget' required."
    exit 1
  fi
  if [[ $ret -eq 0 ]]; then
    mv $tmp_file "${path}/rakudo.tar.gz"
    echo "Download complete!"
  else
    rm -f $tmp_file
    echo "Download error. Exiting."
    exit 1
  fi
}

http_download $ASDF_INSTALL_VERSION $ASDF_DOWNLOAD_PATH $ASDF_INSTALL_TYPE
